<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Text / HTML Input Example</title>
  <style>
    :root{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial}
    body{max-width:980px;margin:24px auto;padding:0 16px;color:#111}
    h1{font-size:20px;margin-bottom:8px}
    .row{display:flex;gap:12px;align-items:flex-start}
    .col{flex:1}
    label{display:block;margin-bottom:6px;font-weight:600}
    textarea{width:100%;min-height:160px;padding:10px;border:1px solid #ccc;border-radius:6px;resize:vertical}
    .toolbar{display:flex;gap:8px;margin-bottom:8px}
    .btn{padding:8px 12px;border-radius:6px;border:1px solid #bbb;background:#f6f6f6;cursor:pointer}
    .btn.primary{background:#0066cc;color:#fff;border-color:#005bb5}
    #htmlEditor{min-height:160px;padding:10px;border:1px solid #ccc;border-radius:6px;overflow:auto}
    .preview{border:1px dashed #bbb;padding:12px;border-radius:6px;min-height:120px;background:#fff}
    .meta{font-size:13px;color:#555;margin-top:8px}
    .small{font-size:13px;color:#666}
    .flex-between{display:flex;justify-content:space-between;align-items:center}
    pre{white-space:pre-wrap;background:#f4f4f4;padding:10px;border-radius:6px;border:1px solid #eee;overflow:auto}
  </style>
</head>
<body>
  <h1>Input: Plain Text or HTML (WYSIWYG)</h1>
  <p class="small">Type plain text or use the HTML editor. Preview will show rendered HTML. On submit, a flag <code>is_html</code> tells your server how to treat the content.</p>

  <div class="row" style="margin-top:12px">
    <div class="col" style="min-width:420px">
      <div class="flex-between">
        <div>
          <label for="mode">Input Mode</label>
          <select id="mode" aria-label="mode">
            <option value="text">Plain text (textarea)</option>
            <option value="html">HTML editor (rich text)</option>
            <option value="source">HTML source (textarea)</option>
          </select>
        </div>

        <div style="text-align:right">
          <label style="font-weight:600">Auto-preview</label><br/>
          <input type="checkbox" id="autopreview" checked /> <label for="autopreview" class="small">on</label>
        </div>
      </div>

      <div style="margin-top:10px">
        <!-- Plain text textarea -->
        <div id="textAreaWrap">
          <label for="textInput">Plain text input</label>
          <textarea id="textInput" placeholder="Enter plain text..."></textarea>
        </div>

        <!-- HTML WYSIWYG editor -->
        <div id="htmlWrap" style="display:none">
          <div class="toolbar">
            <button class="btn" type="button" data-cmd="bold"><b>B</b></button>
            <button class="btn" type="button" data-cmd="italic"><i>I</i></button>
            <button class="btn" type="button" data-cmd="underline"><u>U</u></button>
            <button class="btn" type="button" data-cmd="insertUnorderedList">• List</button>
            <button class="btn" type="button" id="cleanBtn">Clear Formatting</button>
          </div>
          <label for="htmlEditor">HTML editor (contenteditable)</label>
          <div id="htmlEditor" contenteditable="true" aria-multiline="true" role="textbox">
            <p>Write <strong>rich</strong> content here — <em>bold, lists, links</em>, etc.</p>
          </div>
        </div>

        <!-- HTML source textarea -->
        <div id="sourceWrap" style="display:none">
          <label for="sourceInput">HTML source</label>
          <textarea id="sourceInput" placeholder="Enter HTML source..."></textarea>
        </div>

        <div style="margin-top:12px" class="flex-between">
          <div>
            <button class="btn primary" id="previewBtn">Preview</button>
            <button class="btn" id="submitBtn">Submit</button>
            <button class="btn" id="clearBtn">Clear</button>
          </div>
          <div class="meta">
            <strong>Preview Mode:</strong> <span id="previewMode">Rendered</span>
          </div>
        </div>
      </div>

      <div style="margin-top:12px">
        <label>Raw payload that will be sent to the server:</label>
        <pre id="payload">No payload yet</pre>
      </div>
    </div>

    <div class="col">
      <label>Preview (renders HTML)</label>
      <div class="preview" id="previewArea">Preview will appear here</div>
      <div class="meta">Use preview to confirm how HTML will render. Server MUST sanitize before storing or outputting.</div>
    </div>
  </div>

  <script>
    const mode = document.getElementById('mode');
    const textWrap = document.getElementById('textAreaWrap');
    const htmlWrap = document.getElementById('htmlWrap');
    const sourceWrap = document.getElementById('sourceWrap');
    const textInput = document.getElementById('textInput');
    const htmlEditor = document.getElementById('htmlEditor');
    const sourceInput = document.getElementById('sourceInput');
    const previewBtn = document.getElementById('previewBtn');
    const previewArea = document.getElementById('previewArea');
    const previewModeLabel = document.getElementById('previewMode');
    const payload = document.getElementById('payload');
    const submitBtn = document.getElementById('submitBtn');
    const autopreview = document.getElementById('autopreview');
    const clearBtn = document.getElementById('clearBtn');
    const cleanBtn = document.getElementById('cleanBtn');

    function updateUI() {
      const m = mode.value;
      textWrap.style.display = (m === 'text') ? '' : 'none';
      htmlWrap.style.display = (m === 'html') ? '' : 'none';
      sourceWrap.style.display = (m === 'source') ? '' : 'none';
      previewModeLabel.textContent = (m === 'text') ? 'Escaped text' : 'Rendered HTML';
      if (autopreview.checked) renderPreview();
    }

    mode.addEventListener('change', updateUI);
    autopreview.addEventListener('change', renderPreview);

    // toolbar for contenteditable
    document.querySelectorAll('[data-cmd]').forEach(b => {
      b.addEventListener('click', e => {
        const cmd = e.currentTarget.getAttribute('data-cmd');
        document.execCommand(cmd, false, null);
        if (autopreview.checked) renderPreview();
      });
    });

    cleanBtn.addEventListener('click', () => {
      document.execCommand('removeFormat', false, null);
      // remove inline styles, etc. naive clean:
      const selHtml = htmlEditor.innerHTML;
      htmlEditor.innerHTML = selHtml; // keep simple
      if (autopreview.checked) renderPreview();
    });

    function escapeHtml(s) {
      return s
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#39;');
    }

    function getPayloadObject() {
      const m = mode.value;
      let content = '';
      let is_html = false;

      if (m === 'text') {
        content = textInput.value || '';
        // when saving plain text, we still send raw text; server can escape when outputting
        is_html = false;
      } else if (m === 'html') {
        // contenteditable - get innerHTML as HTML content
        content = htmlEditor.innerHTML || '';
        is_html = true;
      } else { // source
        content = sourceInput.value || '';
        is_html = true;
      }

      return {
        content,
        is_html
      };
    }

    function renderPreview() {
      const obj = getPayloadObject();
      payload.textContent = JSON.stringify(obj, null, 2);

      if (obj.is_html) {
        // render as HTML (dangerous if this were untrusted)
        previewArea.innerHTML = obj.content || '<i>(empty)</i>';
      } else {
        // escape text to show as text
        previewArea.innerHTML = '<pre style="margin:0;white-space:pre-wrap;">' +
          escapeHtml(obj.content || '(empty)') + '</pre>';
      }
    }

    previewBtn.addEventListener('click', renderPreview);

    clearBtn.addEventListener('click', () => {
      textInput.value = '';
      htmlEditor.innerHTML = '';
      sourceInput.value = '';
      renderPreview();
    });

    // Example submit: POST JSON to /submit (replace URL with your server endpoint)
    submitBtn.addEventListener('click', async () => {
      const obj = getPayloadObject();
      payload.textContent = JSON.stringify(obj, null, 2);

      // simple client-side validation
      if (!obj.content.trim()) {
        alert('Please enter some content to submit.');
        return;
      }

      // Show what would be sent (replace with actual fetch to your endpoint)
      alert('Demo: payload prepared. Replace this alert with actual POST to server.\n\n' +
            'Payload:\n' + JSON.stringify(obj, null, 2));

      /* Example to send to server:
      try {
        const res = await fetch('/submit.php', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(obj)
        });
        const json = await res.json();
        console.log('server response', json);
      } catch (err) {
        console.error(err);
      }
      */
    });

    // initial render
    updateUI();
  </script>
</body>
</html>
