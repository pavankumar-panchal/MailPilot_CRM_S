import{a as e,j as a,R as s}from"./react-core-Bz_OFM-J.js";import{a as t}from"./axios-nQejdAY5.js";import{A as r}from"./index-2wpkHUii.js";import"./editor-t5Pr0pkD.js";import"./react-dom-oZ-VTmTY.js";import"./vendor-ZyZh7GQr.js";import"./react-router-Cm8bNIlG.js";const n=r.API_MASTER_CAMPAIGNS,l=()=>{const[s,r]=e.useState([]),[l,c]=e.useState(!0),[d,m]=e.useState(null),[x,g]=e.useState({}),[p,u]=e.useState({}),[h,b]=e.useState({page:1,rowsPerPage:10,total:0});e.useEffect(()=>{if(d){const e=setTimeout(()=>m(null),3e3);return()=>clearTimeout(e)}},[d]);const f=e.useCallback(async()=>{try{const e=await t.post(n,{action:"list"});if(!e?.data)throw new Error("No response data");if(!1===e.data.success)throw new Error(e.data.message||"API returned failure");const a=e.data.data&&e.data.data.campaigns||[];return r(a),b(e=>({...e,total:a.length})),c(!1),a}catch(e){return m({type:"error",text:`Failed to load data: ${e?.response?.data?.message||e?.message||"Unknown error"}`}),c(!1),[]}},[]),y=e.useMemo(()=>s.some(e=>"running"===e.campaign_status),[s]);e.useEffect(()=>{f();const e=y?5e3:3e4;let a;const s=()=>{document.hidden?clearInterval(a):(f(),a=setInterval(f,e))};return a=setInterval(f,e),document.addEventListener("visibilitychange",s),()=>{clearInterval(a),document.removeEventListener("visibilitychange",s)}},[f,y]);const j=e.useCallback(async e=>{try{const a=await t.post(n,{action:"email_counts",campaign_id:e});if(!1===a?.data?.success)throw new Error(a.data.message||"Failed to get counts");u(s=>({...s,[e]:a.data.data||a.data}))}catch(a){m({type:"error",text:"Failed to fetch email counts"})}},[]);e.useEffect(()=>{if(!y)return;const e=setInterval(()=>{r(e=>(g(a=>(e.forEach(e=>{"running"===e.campaign_status&&a[e.campaign_id]&&j(e.campaign_id)}),a)),e))},3e3);return()=>clearInterval(e)},[y,j]);const w=e.useMemo(()=>Math.max(1,Math.ceil(h.total/h.rowsPerPage)),[h.total,h.rowsPerPage]),N=e.useMemo(()=>s.slice((h.page-1)*h.rowsPerPage,h.page*h.rowsPerPage),[s,h.page,h.rowsPerPage]),v=e.useCallback(async e=>{g(a=>{const s=!a[e];return s&&u(a=>(a[e]||j(e),a)),{...a,[e]:s}})},[j]),k=e.useCallback(async e=>{try{const a=await t.post(n,{action:"start_campaign",campaign_id:e});if(!1===a?.data?.success)throw new Error(a.data.message||"Failed to start campaign");m({type:"success",text:a.data.message||"Campaign started"}),await f()}catch(a){m({type:"error",text:a.response?.data?.error||"Failed to start campaign"})}},[f]),_=e.useCallback(async e=>{try{const a=await t.post(n,{action:"pause_campaign",campaign_id:e});if(!1===a?.data?.success)throw new Error(a.data.message||"Failed to pause campaign");m({type:"success",text:a.data.message||"Campaign paused"}),await f()}catch(a){m({type:"error",text:a.response?.data?.error||"Failed to pause campaign"})}},[f]),C=e.useCallback(async e=>{try{const a=await t.post(n,{action:"retry_failed",campaign_id:e});if(!1===a?.data?.success)throw new Error(a.data.message||"Failed to retry");m({type:"success",text:a.data.message||"Retry started"}),await f()}catch(a){m({type:"error",text:a.response?.data?.error||"Failed to retry failed emails"})}},[f]);return l?a.jsx("div",{className:"flex justify-center items-center h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):a.jsx("div",{className:"bg-gray-100 min-h-screen mt-14",children:a.jsxs("div",{className:"container mx-auto px-2 sm:px-4 py-6 w-full max-w-7xl",children:[a.jsx(o,{message:d,onClose:()=>m(null)}),a.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:N.map(e=>{const s=p[e.campaign_id]||{};return a.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden transition-all hover:shadow-lg",children:a.jsxs("div",{className:"p-4 sm:p-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-800 mb-1 break-words",children:e.description}),a.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-2 break-words",children:e.mail_subject}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4",children:[a.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full bg-green-100 text-green-800 text-xs sm:text-sm font-medium",children:[a.jsx("i",{className:"fas fa-envelope mr-1"}),Number(e.valid_emails)?.toLocaleString()," Emails"]}),a.jsx(i,{status:e.campaign_status})]})]}),a.jsxs("div",{className:"flex flex-row flex-wrap gap-2 items-center mt-2 sm:mt-0",children:[a.jsx("button",{onClick:()=>v(e.campaign_id),className:"text-gray-500 hover:text-gray-700 px-2 py-1 rounded-lg",children:a.jsx("i",{className:`fas ${x[e.campaign_id]?"fa-chevron-up":"fa-chevron-down"} text-sm`})}),"running"===e.campaign_status?a.jsxs("button",{onClick:()=>_(e.campaign_id),className:"px-3 sm:px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg text-xs sm:text-sm font-medium",children:[a.jsx("i",{className:"fas fa-pause mr-1"})," Pause"]}):"completed"===e.campaign_status?a.jsxs("span",{className:"px-3 sm:px-4 py-2 bg-gray-200 text-gray-600 rounded-lg text-xs sm:text-sm font-medium",children:[a.jsx("i",{className:"fas fa-check-circle mr-1"})," Completed"]}):a.jsxs("button",{onClick:()=>k(e.campaign_id),className:"px-3 sm:px-4 py-2 bg-green-500 hover:bg-green-700 text-white rounded-lg text-xs sm:text-sm font-medium",children:[a.jsx("i",{className:"fas fa-paper-plane mr-1"})," Send"]}),e.retryable_count>0&&"completed"!==e.campaign_status&&a.jsxs("button",{onClick:()=>C(e.campaign_id),className:"px-3 sm:px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs sm:text-sm font-medium",children:[a.jsx("i",{className:"fas fa-redo mr-1"})," Retry (",e.retryable_count,")"]})]})]}),x[e.campaign_id]&&a.jsx("div",{className:"mt-6",children:a.jsxs("div",{className:"space-y-3 mb-4",children:[a.jsxs("div",{className:"flex flex-wrap gap-4",children:[a.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 flex flex-col items-center min-w-[120px]",children:[a.jsx("span",{className:"text-xs text-gray-500",children:"Pending"}),a.jsx("span",{className:"font-bold text-lg text-blue-700",children:s.pending||e.pending_emails||0})]}),a.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 flex flex-col items-center min-w-[120px]",children:[a.jsx("span",{className:"text-xs text-gray-500",children:"Sent"}),a.jsx("span",{className:"font-bold text-lg text-green-700",children:s.sent||e.sent_emails||0})]}),a.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 flex flex-col items-center min-w-[120px]",children:[a.jsx("span",{className:"text-xs text-gray-500",children:"Failed"}),a.jsx("span",{className:"font-bold text-lg text-red-700",children:s.failed||e.failed_emails||0})]})]}),a.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:["Started: ",e.start_time?e.start_time:"N/A",a.jsx("br",{}),"Ended: ",e.end_time?e.end_time:"N/A"]})]})})]})},e.campaign_id)})}),s.length>0&&a.jsxs("div",{className:"flex flex-col items-center justify-center mt-6 px-1 gap-2",children:[a.jsxs("div",{className:"text-xs sm:text-sm text-gray-500 mb-2",children:["Showing"," ",a.jsx("span",{className:"font-medium",children:(h.page-1)*h.rowsPerPage+1})," ","to"," ",a.jsx("span",{className:"font-medium",children:Math.min(h.page*h.rowsPerPage,h.total)})," ","of ",a.jsx("span",{className:"font-medium",children:h.total})," ","campaigns"]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsx("button",{onClick:()=>b(e=>({...e,page:1})),disabled:1===h.page,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors",children:a.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})})}),a.jsx("button",{onClick:()=>b(e=>({...e,page:e.page-1})),disabled:1===h.page,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors",children:a.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),a.jsxs("span",{className:"text-xs sm:text-sm font-medium text-gray-700",children:["Page ",h.page," of ",w]}),a.jsx("button",{onClick:()=>b(e=>({...e,page:Math.min(w,e.page+1)})),disabled:h.page>=w,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors",children:a.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})}),a.jsx("button",{onClick:()=>b(e=>({...e,page:w})),disabled:h.page>=w,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors",children:a.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}),a.jsx("select",{value:h.rowsPerPage,onChange:e=>b(a=>({...a,rowsPerPage:Number(e.target.value),page:1})),className:"border p-2 rounded-lg text-xs sm:text-sm bg-white focus:ring-blue-500 focus:border-blue-500 transition-colors",children:[10,25,50,100].map(e=>a.jsx("option",{value:e,children:e},e))})]})]})]})})},i=s.memo(({status:e})=>{const s=(e||"pending").toLowerCase(),t=e||"Pending";return a.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold text-white ${{pending:"bg-yellow-500",running:"bg-blue-500",paused:"bg-gray-500",completed:"bg-green-500",failed:"bg-red-500"}[s]||"bg-yellow-500"}`,children:t})}),o=s.memo(({message:e,onClose:s})=>e?a.jsxs("div",{className:"fixed top-6 left-1/2 transform -translate-x-1/2 z-50\n      px-6 py-3 rounded-xl shadow text-base font-semibold\n      flex items-center gap-3\n      "+("error"===e.type?"bg-red-200/60 border border-red-400 text-red-800":"bg-green-200/60 border border-green-400 text-green-800"),style:{minWidth:250,maxWidth:400,boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.23)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},role:"alert",children:[a.jsx("i",{className:"fas text-lg "+("error"===e.type?"fa-exclamation-circle text-red-500":"fa-check-circle text-green-500")}),a.jsx("span",{className:"flex-1",children:e.text}),a.jsx("button",{onClick:s,className:"ml-2 text-gray-500 hover:text-gray-700 focus:outline-none","aria-label":"Close",children:a.jsx("i",{className:"fas fa-times"})})]}):null);i.displayName="StatusBadge",o.displayName="StatusMessage";export{l as default};
