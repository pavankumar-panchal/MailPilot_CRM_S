import{a as e,j as t}from"./react-core-DPHBRSZI.js";import{g as a,a as s,A as r}from"./index-CyabgCnR.js";import"./react-dom-CzVnfz0w.js";import"./vendor-CNpwfz3n.js";import"./react-router-CQqd29q0.js";const l=({message:e,onClose:a})=>e&&t.jsxs("div",{className:`\n        fixed top-6 left-1/2 transform -translate-x-1/2\n        px-6 py-3 rounded-xl shadow text-base font-semibold\n        flex items-center gap-3\n        transition-all duration-300\n        backdrop-blur-md\n        ${"error"===e.type?"bg-red-200/60 border border-red-400 text-red-800":"bg-green-200/60 border border-green-400 text-green-800"}\n      `,style:{minWidth:250,maxWidth:400,zIndex:99999,boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.23)",background:"error"===e.type?"rgba(255, 0, 0, 0.29)":"rgba(0, 200, 83, 0.29)",borderRadius:"16px",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},role:"alert",children:[t.jsx("i",{className:"fas text-lg "+("error"===e.type?"fa-exclamation-circle text-red-500":"fa-check-circle text-green-500")}),t.jsx("span",{className:"flex-1",children:e.text}),t.jsx("button",{onClick:a,className:"ml-2 hover:opacity-70 focus:outline-none transition-opacity","aria-label":"Close",children:t.jsx("i",{className:"fas fa-times"})})]}),i=()=>{const[i,n]=e.useState([]),[o,d]=e.useState(!1),[c,m]=e.useState(!1),[x,p]=e.useState(null),[g,h]=e.useState(!1),[u,f]=e.useState({type:"",text:""}),[b,y]=e.useState(""),[j,N]=e.useState([]),[v,w]=e.useState(!1),[_,k]=e.useState({}),[C,T]=e.useState(!1),S=a(),F=`${S}/backend/includes/mail_templates.php`,$=`${S}/backend/includes/upload_image.php`,[P,D]=e.useState({template_name:"",template_description:"",template_html:"",merge_fields:[],is_active:1});e.useEffect(()=>{E()},[]),e.useEffect(()=>{if(u.text){const e=setTimeout(()=>{f({type:"",text:""})},5e3);return()=>clearTimeout(e)}},[u]);const E=async()=>{d(!0);try{const e=await s(`${F}?action=list`);if(!e.ok){const t=await e.json().catch(()=>({}));throw new Error(t.error||`HTTP error! status: ${e.status}`)}const t=await e.json();t.success?(n(t.templates),"error"===u.type&&f({type:"",text:""})):f({type:"error",text:t.error||"Failed to load templates"})}catch(e){n([]),f({type:"error",text:e.message||"Failed to load templates."})}finally{d(!1)}},I=()=>{m(!1),p(null),D({template_name:"",template_description:"",template_html:"",merge_fields:[],is_active:1})},O=()=>{const e=P.template_html,t=/\[\[([^\]]+)\]\]/g,a=[];let s;for(;null!==(s=t.exec(e));)a.includes(s[1])||a.push(s[1]);D(e=>({...e,merge_fields:a})),a.length>0?f({type:"success",text:`Found ${a.length} merge fields: ${a.join(", ")}`}):f({type:"error",text:"No merge fields found. Use [[FieldName]] syntax."})},U=e=>{const t=/<img[^>]+src=["']([^"']+)["']/gi,a=[];let s;for(;null!==(s=t.exec(e));){const e=s[1];e.startsWith(S)||e.startsWith("data:")||a.push(e)}return[...new Set(a)]};return t.jsxs("div",{className:"container mx-auto mt-12 px-2 sm:px-4 py-8 max-w-7xl",children:[u.text&&t.jsx(l,{message:u,onClose:()=>f({type:"",text:""})}),t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[t.jsx("i",{className:"fas fa-file-code mr-2 text-blue-600"}),"Mail Templates"]}),t.jsxs("button",{onClick:()=>m(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center",children:[t.jsx("i",{className:"fas fa-plus mr-2"})," Add Template"]})]}),o&&0===i.length?t.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden p-8",children:t.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[t.jsx("div",{className:"relative mb-4",children:t.jsx("div",{className:"w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"})}),t.jsx("p",{className:"text-gray-600 font-medium",children:"Loading templates..."})]})}):0===i.length?t.jsx("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center",children:t.jsx("i",{className:"fas fa-file-code text-2xl text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:"No Templates Yet"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Create your first template to get started with personalized email campaigns."})]}),t.jsxs("button",{className:"mt-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center gap-2",onClick:()=>m(!0),children:[t.jsx("i",{className:"fas fa-plus"}),t.jsx("span",{children:"Create First Template"})]})]})}):t.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"w-16 px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Merge Fields"}),t.jsx("th",{className:"w-32 px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"w-32 px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map((e,a)=>t.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[t.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-500",children:a+1}),t.jsxs("td",{className:"px-4 py-3",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.template_name}),t.jsx("div",{className:"text-xs text-gray-500",children:e.html_length?`${(e.html_length/1024).toFixed(1)} KB`:"No content"})]}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("div",{className:"text-sm text-gray-600 max-w-xs truncate",children:e.template_description||"No description"})}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("div",{className:"flex flex-wrap gap-1 max-w-sm",children:e.merge_fields&&e.merge_fields.length>0?t.jsxs(t.Fragment,{children:[e.merge_fields.slice(0,3).map(e=>t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:["[[",e,"]]"]},e)),e.merge_fields.length>3&&t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-600",children:["+",e.merge_fields.length-3," more"]})]}):t.jsx("span",{className:"text-xs text-gray-400 italic",children:"No fields"})})}),t.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+(e.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"),children:e.is_active?"Active":"Inactive"})}),t.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx("button",{onClick:()=>(e=>{p(e),D({template_id:e.template_id,template_name:e.template_name,template_description:e.template_description||"",template_html:"",merge_fields:e.merge_fields||[],is_active:e.is_active}),fetch(`${F}?action=get&template_id=${e.template_id}`,{credentials:"include"}).then(e=>e.json()).then(e=>{e.success&&D(t=>({...t,template_html:e.template.template_html}))}),m(!0)})(e),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-50",title:"Edit",children:t.jsx("i",{className:"fas fa-edit"})}),t.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this template?"))try{const t=await s(`${F}?action=delete&template_id=${e}`,{method:"DELETE"}),a=await t.json();a.success?(f({type:"success",text:"Template deleted successfully"}),E()):f({type:"error",text:a.error||"Failed to delete template"})}catch(t){f({type:"error",text:"Failed to delete template"})}})(e.template_id),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-50",title:"Delete",children:t.jsx("i",{className:"fas fa-trash"})})]})})]},e.template_id))})]})})}),c&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"flex justify-between items-center px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-purple-50",children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[t.jsx("i",{className:`fas ${x?"fa-edit":"fa-plus-circle"} text-blue-600`}),x?"Edit Template":"Create New Template"]}),t.jsx("button",{type:"button",className:"text-gray-400 hover:text-gray-600 transition-colors p-2",onClick:I,children:t.jsx("i",{className:"fas fa-times text-xl"})})]}),t.jsxs("form",{onSubmit:async e=>{e.preventDefault(),d(!0);try{const e=x?`${F}?action=update`:`${F}?action=create`,t=x?"PUT":"POST",a=await s(e,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(P)}),r=await a.json();r.success?(f({type:"success",text:x?"Template updated successfully":"Template created successfully"}),E(),I()):f({type:"error",text:r.error||"Operation failed"})}catch(t){f({type:"error",text:"Failed to save template"})}finally{d(!1)}},className:"flex-1 overflow-y-auto",children:[t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"md:col-span-2",children:[t.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Template Name ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",value:P.template_name,onChange:e=>D({...P,template_name:e.target.value}),required:!0,placeholder:"e.g., Outstanding Payment Reminder"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Status"}),t.jsxs("select",{className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",value:P.is_active,onChange:e=>D({...P,is_active:parseInt(e.target.value)}),children:[t.jsx("option",{value:"1",children:"Active"}),t.jsx("option",{value:"0",children:"Inactive"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Description"}),t.jsx("textarea",{className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none",rows:"2",value:P.template_description,onChange:e=>D({...P,template_description:e.target.value}),placeholder:"Brief description of this template's purpose"})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsxs("label",{className:"block text-sm font-semibold text-gray-700",children:["HTML Template ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-50 to-purple-100 text-purple-700 rounded-lg hover:from-purple-100 hover:to-purple-200 transition-all text-sm font-medium border border-purple-200 cursor-pointer",children:[t.jsx("i",{className:"fas fa-file-upload"}),"Upload HTML File",t.jsx("input",{type:"file",accept:".html,.htm",onChange:e=>{const t=e.target.files[0];if(!t)return;const a=new FileReader;a.onload=e=>{const t=e.target.result;D(e=>({...e,template_html:t})),O();const a=U(t);a.length>0&&(N(a),f({type:"error",text:`Found ${a.length} external/local images. Please upload them to ensure emails display correctly.`}),w(!0))},a.readAsText(t)},className:"hidden"})]}),t.jsxs("button",{type:"button",className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-orange-50 to-orange-100 text-orange-700 rounded-lg hover:from-orange-100 hover:to-orange-200 transition-all text-sm font-medium border border-orange-200",onClick:()=>{const e=U(P.template_html);e.length>0?(N(e),w(!0),f({type:"error",text:`Found ${e.length} external/local images that need to be uploaded`})):f({type:"success",text:"All images are already hosted correctly!"})},disabled:!P.template_html,children:[t.jsx("i",{className:"fas fa-images"}),"Check Images"]}),t.jsxs("button",{type:"button",className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-50 to-cyan-100 text-cyan-700 rounded-lg hover:from-cyan-100 hover:to-cyan-200 transition-all text-sm font-medium border border-cyan-200",onClick:O,children:[t.jsx("i",{className:"fas fa-search"}),"Detect Fields"]}),t.jsxs("button",{type:"button",className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-50 to-green-100 text-green-700 rounded-lg hover:from-green-100 hover:to-green-200 transition-all text-sm font-medium border border-green-200",onClick:async()=>{try{let t=null;try{const e=await s(`${r.API_IMPORT_DATA}?action=list`),a=await e.json();a.success&&a.batches&&a.batches.length>0&&(t=a.batches[0].import_batch_id)}catch(e){}const a=await s(`${F}?action=merge_preview`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template_html:P.template_html,import_batch_id:t,merge_data:{Amount:"5000",Price:"4237",Tax:"763",NetPrice:"5000",Days:"30",BilledName:"Sample Company Pvt Ltd",Company:"Sample Company Pvt Ltd",CustomerID:"CUST001",BillNumber:"INV-2025-001",BillDate:"January 15, 2025",ExecutiveName:"John Doe",ExecutiveContact:"+91-9876543210",DealerName:"Sample Dealer",DealerEmail:"dealer@example.com",DealerCell:"+91-9876543210",Email:"customer@example.com",Emails:"customer@example.com",Phone:"+91-9876543210",Edition:"Professional",UsageType:"Multi-User",LastProduct:"SaralTDS 2024",DISTRICT:"Sample District"}})}),l=await a.json();l.success?(y(l.merged_html),h(!0),l.merge_fields_found&&D(e=>({...e,merge_fields:l.merge_fields_found})),"database"===l.data_source&&f({type:"success",text:"Preview using real data from latest import"})):f({type:"error",text:l.error||"Preview failed"})}catch(t){f({type:"error",text:"Failed to generate preview"})}},disabled:!P.template_html,children:[t.jsx("i",{className:"fas fa-eye"}),"Preview"]})]})]}),t.jsx("textarea",{className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all font-mono text-sm resize-none",rows:"18",value:P.template_html,onChange:e=>D({...P,template_html:e.target.value}),required:!0,placeholder:"Paste your HTML template here OR use 'Upload HTML File' button above. Use [[FieldName]] for merge fields."}),t.jsxs("p",{className:"mt-2 text-sm text-gray-600 bg-blue-50 border border-blue-200 rounded-lg p-3",children:[t.jsx("i",{className:"fas fa-info-circle text-blue-600 mr-2"}),t.jsx("strong",{children:"Tip:"})," Use double brackets for merge fields: ",t.jsx("code",{className:"bg-white px-2 py-1 rounded text-blue-700",children:"[[FieldName]]"}),t.jsx("br",{}),t.jsx("span",{className:"ml-5",children:'Upload HTML file or paste directly. Click "Check Images" to upload any local/external images.'})]})]}),P.merge_fields.length>0&&t.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-xl p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx("i",{className:"fas fa-tags text-blue-600"}),t.jsxs("strong",{className:"text-gray-800",children:["Detected Merge Fields (",P.merge_fields.length,")"]})]}),t.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:P.merge_fields.map(e=>t.jsxs("span",{className:"px-3 py-1.5 bg-white text-blue-700 rounded-lg text-sm font-mono border border-blue-300 shadow-sm",children:["[[",e,"]]"]},e))}),t.jsxs("p",{className:"text-sm text-gray-700",children:[t.jsx("i",{className:"fas fa-lightbulb text-yellow-500 mr-2"}),"These fields will be replaced with actual data from your CSV when sending campaigns."]})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 px-6 py-4 border-t border-gray-200 bg-gray-50",children:[t.jsx("button",{type:"button",className:"px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all font-medium",onClick:I,children:"Cancel"}),t.jsx("button",{type:"submit",className:"flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 transition-all shadow-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed",disabled:o,children:o?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),t.jsx("span",{children:"Saving..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-save"}),t.jsx("span",{children:x?"Update Template":"Create Template"})]})})]})]})]})}),g&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"flex justify-between items-center px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-green-50 to-teal-50",children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[t.jsx("i",{className:"fas fa-eye text-green-600"}),"Template Preview",t.jsx("span",{className:"text-sm font-normal text-gray-600",children:"(with sample data)"})]}),t.jsx("button",{type:"button",className:"text-gray-400 hover:text-gray-600 transition-colors p-2",onClick:()=>h(!1),children:t.jsx("i",{className:"fas fa-times text-xl"})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-100",children:t.jsx("div",{className:"p-8",children:t.jsx("iframe",{srcDoc:b,style:{width:"100%",minHeight:"600px",border:"none",background:"white",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},title:"Template Preview"})})}),t.jsx("div",{className:"flex justify-end px-6 py-4 border-t border-gray-200 bg-gray-50",children:t.jsx("button",{type:"button",className:"px-6 py-2.5 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-xl hover:from-gray-700 hover:to-gray-800 transition-all font-medium",onClick:()=>h(!1),children:"Close Preview"})})]})}),v&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"flex justify-between items-center px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-orange-50 to-red-50",children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[t.jsx("i",{className:"fas fa-images text-orange-600"}),"Upload External/Local Images",t.jsxs("span",{className:"text-sm font-normal text-gray-600",children:["(",j.length," found)"]})]}),t.jsx("button",{type:"button",className:"text-gray-400 hover:text-gray-600 transition-colors p-2",onClick:()=>w(!1),children:t.jsx("i",{className:"fas fa-times text-xl"})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[t.jsx("div",{className:"mb-4 bg-orange-50 border border-orange-200 rounded-lg p-4",children:t.jsxs("p",{className:"text-sm text-gray-700",children:[t.jsx("i",{className:"fas fa-exclamation-triangle text-orange-600 mr-2"}),t.jsx("strong",{children:"Important:"})," Your HTML contains images with external or local paths. Upload them here so they display correctly in emails."]})}),t.jsx("div",{className:"space-y-4",children:j.map((e,a)=>t.jsx("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:t.jsx("i",{className:"fas fa-image text-orange-600 text-xl"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900 mb-1",children:["Image ",a+1]}),t.jsx("div",{className:"text-xs text-gray-600 font-mono bg-white px-2 py-1 rounded border border-gray-200 break-all mb-2",children:e}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"file",accept:"image/*",onChange:t=>{return a=e,s=t.target.files[0],void k(e=>({...e,[a]:s}));var a,s},className:"hidden"}),t.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx("i",{className:"fas fa-upload"}),_[e]?"Change File":"Select File"]}),_[e]&&t.jsxs("span",{className:"text-sm text-green-600 font-medium",children:[t.jsx("i",{className:"fas fa-check-circle mr-1"}),_[e].name]})]})]})]})},a))})]}),t.jsxs("div",{className:"flex justify-end gap-3 px-6 py-4 border-t border-gray-200 bg-gray-50",children:[t.jsx("button",{type:"button",className:"px-6 py-2.5 bg-gray-600 text-white rounded-xl hover:bg-gray-700 transition-all font-medium",onClick:()=>{w(!1),N([]),k({})},children:"Skip for Now"}),t.jsx("button",{type:"button",className:"px-6 py-2.5 bg-gradient-to-r from-orange-600 to-red-600 text-white rounded-xl hover:from-orange-700 hover:to-red-700 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed",onClick:async()=>{T(!0);try{let a=P.template_html;const s={};for(const[r,l]of Object.entries(_)){if(!l)continue;const a=new FormData;a.append("image",l);try{const t=await fetch($,{method:"POST",credentials:"include",body:a}),i=await t.text();let n;try{n=JSON.parse(i)}catch(e){throw new Error(`Invalid JSON response for ${l.name}: ${i.substring(0,100)}`)}if(!n.success)throw new Error(n.message||`Failed to upload ${l.name}`);{const e=`${S}/backend/${n.path}`;s[r]=e}}catch(t){throw t}}for(const[e,t]of Object.entries(s)){const s=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(s,"g");a=a.replace(r,t)}D(e=>({...e,template_html:a})),N([]),k({}),w(!1),f({type:"success",text:`Successfully uploaded and replaced ${Object.keys(s).length} images`})}catch(a){f({type:"error",text:a.message||"Failed to upload images"})}finally{T(!1)}},disabled:C||0===Object.keys(_).length,children:C?t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Uploading..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-cloud-upload-alt mr-2"}),"Upload & Replace URLs (",Object.keys(_).length,"/",j.length,")"]})})]})]})})]})};export{i as default};
