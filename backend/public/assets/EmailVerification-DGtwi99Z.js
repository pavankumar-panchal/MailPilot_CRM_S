import{a as e,j as t}from"./react-core-DPHBRSZI.js";import{T as s}from"./SkeletonLoader--gW7sJuH.js";import{A as a,a as r,g as l}from"./index-yWi9ERo7.js";import"./react-dom-CzVnfz0w.js";import"./vendor-CNpwfz3n.js";import"./react-router-CQqd29q0.js";const i=({onLogin:s,onSwitchToRegister:a})=>{const[r,l]=e.useState(""),[i,o]=e.useState(""),[n,d]=e.useState(""),[c,m]=e.useState(!1);return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-600 to-blue-600 px-4",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"ðŸ“§ Relyon CRM"}),t.jsx("p",{className:"text-gray-600",children:"Login to your account"})]}),t.jsxs("form",{onSubmit:async e=>{e.preventDefault(),m(!0),d("");try{const e=await fetch("/api/login.php",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:r,password:i})}),t=await e.json();t.success?(localStorage.setItem("mailpilot_user",JSON.stringify(t.user)),localStorage.setItem("mailpilot_token",t.token),s(t.user,t.token)):d(t.message||"Login failed")}catch(t){d("Network error. Please check your connection and try again.")}finally{m(!1)}},className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),t.jsx("input",{type:"email",value:r,onChange:e=>l(e.target.value),placeholder:"your@email.com",required:!0,disabled:c,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),t.jsx("input",{type:"password",value:i,onChange:e=>o(e.target.value),placeholder:"Enter your password",required:!0,disabled:c,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"})]}),n&&t.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg",children:n}),t.jsx("button",{type:"submit",disabled:c,className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-all",children:c?"Logging in...":"Login"})]}),t.jsxs("p",{className:"text-center mt-6 text-gray-600",children:["Don't have an account?"," ",t.jsx("button",{onClick:a,className:"text-purple-600 font-semibold hover:underline",children:"Register here"})]})]})})},o=({onRegister:s,onSwitchToLogin:a})=>{const[r,l]=e.useState(""),[i,o]=e.useState(""),[n,d]=e.useState(""),[c,m]=e.useState(""),[x,u]=e.useState(""),[p,g]=e.useState(""),[h,b]=e.useState(!1);return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-600 to-blue-600 px-4",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"ðŸ“§ Relyon CRM"}),t.jsx("p",{className:"text-gray-600",children:"Create your account"})]}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),b(!0),u(""),g(""),!r.trim())return u("Name is required"),void b(!1);if(n.length<6)return u("Password must be at least 6 characters"),void b(!1);if(n!==c)return u("Passwords do not match"),void b(!1);try{const e=await fetch("/api/register.php",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:r,email:i,password:n})}),t=await e.json();t.success?(g(t.message||"Registration successful! Redirecting to login..."),setTimeout(()=>s(),2e3)):u(t.message||"Registration failed")}catch(t){u("Network error. Please check your connection and try again.")}finally{b(!1)}},className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),t.jsx("input",{type:"text",value:r,onChange:e=>l(e.target.value),placeholder:"John Doe",required:!0,disabled:h,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),t.jsx("input",{type:"email",value:i,onChange:e=>o(e.target.value),placeholder:"your@email.com",required:!0,disabled:h,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),t.jsx("input",{type:"password",value:n,onChange:e=>d(e.target.value),placeholder:"At least 6 characters",required:!0,disabled:h,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password"}),t.jsx("input",{type:"password",value:c,onChange:e=>m(e.target.value),placeholder:"Re-enter your password",required:!0,disabled:h,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"})]}),x&&t.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg",children:x}),p&&t.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg",children:p}),t.jsx("button",{type:"submit",disabled:h,className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 transition-all",children:h?"Creating account...":"Register"})]}),t.jsxs("p",{className:"text-center mt-6 text-gray-600",children:["Already have an account?"," ",t.jsx("button",{onClick:a,className:"text-purple-600 font-semibold hover:underline",children:"Login here"})]})]})})},n=({listId:r,onClose:l})=>{const[n,d]=e.useState(!1),[c,m]=e.useState("login"),[x,u]=e.useState(null);e.useEffect(()=>{const e=localStorage.getItem("mailpilot_user"),t=localStorage.getItem("mailpilot_token");if(e&&t)try{const t=JSON.parse(e);u(t),d(!0)}catch(s){localStorage.removeItem("mailpilot_user"),localStorage.removeItem("mailpilot_token")}},[]);const[p,g]=e.useState([]),[h,b]=e.useState(null),[f,y]=e.useState(!1),[j,w]=e.useState({page:1,rowsPerPage:50,total:0}),[v,N]=e.useState("all"),[k,C]=e.useState({all:0,valid:0,invalid:0,timeout:0}),S=e.useCallback(async()=>{try{y(!0);const e="all"!==v?`&filter=${v}`:"",t=`${a.API_RESULTS}&batch_id=${r}&page=${j.page}&limit=${j.rowsPerPage}${e}`,s=await fetch(t,{credentials:"include"});if(!s.ok)throw await s.text(),new Error(`HTTP error! status: ${s.status}`);const l=await s.json();g(Array.isArray(l.data)?l.data:[]),w(e=>({...e,total:l.total||0}))}catch(e){g([]),b({type:"error",message:"Failed to load emails: "+e.message})}finally{y(!1)}},[r,j.page,j.rowsPerPage,v]),L=e.useCallback(async()=>{try{const e=`${a.API_RESULTS}&batch_id=${r}&limit=1`,[t,s,l,i]=await Promise.all([fetch(e,{credentials:"include"}),fetch(`${e}&filter=valid`,{credentials:"include"}),fetch(`${e}&filter=invalid`,{credentials:"include"}),fetch(`${e}&filter=timeout`,{credentials:"include"})]),[o,n,d,c]=await Promise.all([t.json(),s.json(),l.json(),i.json()]);C({all:Number(o?.total??0),valid:Number(n?.total??0),invalid:Number(d?.total??0),timeout:Number(c?.total??0)})}catch(e){C(e=>({...e,all:j.total}))}},[r,j.total]),_=e.useCallback(e=>(e.validation_response||"").toLowerCase().includes("timeout")||(e.validation_response||"").toLowerCase().includes("connection refused")||(e.validation_response||"").toLowerCase().includes("failed to connect"),[]);e.useEffect(()=>{n&&S()},[S,n]),e.useEffect(()=>{n&&L()},[L,n]),e.useEffect(()=>{w(e=>({...e,page:1}))},[v]);const P=e.useCallback(async e=>{try{const t="timeout"===e?"connection_timeout":e,s=`${a.GET_RESULTS}?export=${t}&csv_list_id=${r}`,l=await fetch(s,{credentials:"include"});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const i=await l.blob(),o=window.URL.createObjectURL(i),n=document.createElement("a");n.href=o,n.download=`${e}_emails_list_${r}.csv`,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(o),b({type:"success",message:`Exported all ${e} emails from this list`})}catch(t){b({type:"error",message:`Failed to export ${e} emails: ${t.message}`})}},[r]),M=({status:e,onClose:s})=>e&&t.jsxs("div",{className:"fixed top-6 left-1/2 transform -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow text-base font-semibold flex items-center gap-3 transition-all duration-300 backdrop-blur-md",style:{minWidth:250,maxWidth:400,boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.23)",background:"error"===e.type?"rgba(255, 0, 0, 0.29)":"rgba(0, 200, 83, 0.29)",borderRadius:"16px",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},role:"alert",children:[t.jsx("i",{className:"fas text-lg "+("error"===e.type?"fa-exclamation-circle text-red-500":"fa-check-circle text-green-500")}),t.jsx("span",{className:"flex-1",children:e.message}),t.jsx("button",{onClick:s,className:"ml-2 text-gray-500 hover:text-gray-700 focus:outline-none","aria-label":"Close",children:t.jsx("i",{className:"fas fa-times"})})]});return e.useEffect(()=>{if(h){const e=setTimeout(()=>b(null),4e3);return()=>clearTimeout(e)}},[h]),n?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm p-4",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-7xl max-h-[90vh] flex flex-col",children:[t.jsxs("div",{className:"p-6 pb-4 border-b border-gray-200 flex justify-between items-start",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-1",children:"Email List Details"}),t.jsxs("p",{className:"text-gray-600",children:["List ID: ",r," â€¢ ",k.all.toLocaleString()," total emails"]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("button",{className:"text-gray-500 hover:text-gray-700 p-2 rounded-full hover:bg-gray-100 transition-colors",onClick:l,"aria-label":"Close",children:t.jsx("i",{className:"fas fa-times text-xl"})})})]}),t.jsx(M,{status:h,onClose:()=>b(null)}),t.jsx("div",{className:"p-6 pt-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("button",{onClick:()=>N("all"),className:"px-4 py-2 rounded-lg font-medium text-sm transition-all "+("all"===v?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["All (",k.all.toLocaleString(),")"]}),t.jsxs("button",{onClick:()=>N("valid"),className:"px-4 py-2 rounded-lg font-medium text-sm transition-all "+("valid"===v?"bg-green-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Valid (",k.valid.toLocaleString(),")"]}),t.jsxs("button",{onClick:()=>N("invalid"),className:"px-4 py-2 rounded-lg font-medium text-sm transition-all "+("invalid"===v?"bg-red-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Invalid (",k.invalid.toLocaleString(),")"]}),t.jsxs("button",{onClick:()=>N("timeout"),className:"px-4 py-2 rounded-lg font-medium text-sm transition-all "+("timeout"===v?"bg-yellow-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Timeout (",k.timeout.toLocaleString(),")"]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("button",{onClick:()=>P("valid"),className:"px-4 py-2 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 flex items-center gap-2 transition-colors",disabled:f,children:[t.jsx("i",{className:"fas fa-file-export"}),"Export Valid"]}),t.jsxs("button",{onClick:()=>P("invalid"),className:"px-4 py-2 bg-red-600 text-white rounded-lg font-medium text-sm hover:bg-red-700 flex items-center gap-2 transition-colors",disabled:f,children:[t.jsx("i",{className:"fas fa-file-export"}),"Export Invalid"]}),t.jsxs("button",{onClick:()=>P("timeout"),className:"px-4 py-2 bg-yellow-600 text-white rounded-lg font-medium text-sm hover:bg-yellow-700 flex items-center gap-2 transition-colors",disabled:f,children:[t.jsx("i",{className:"fas fa-file-export"}),"Export Timeout"]})]})]})}),t.jsx("div",{className:"flex-1 overflow-auto",children:f?t.jsx("table",{className:"min-w-full divide-y divide-gray-200 bg-white",children:t.jsx("tbody",{children:t.jsx(s,{rows:10,columns:7})})}):0===p.length?t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("div",{className:"text-center text-gray-500 py-12",children:[t.jsx("i",{className:"fas fa-inbox text-6xl mb-4 text-gray-300"}),t.jsx("p",{className:"text-lg",children:"No emails found"})]})}):t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 bg-white",children:[t.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"ID"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-40",children:"Account"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:"Domain"}),t.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-28",children:"Verified"}),t.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-28",children:"Status"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-64",children:"Response"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:p.map(e=>t.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[t.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500 w-20",children:e.id}),t.jsx("td",{className:"px-4 py-4 text-sm font-medium text-gray-900",children:e.raw_emailid||e.email||"N/A"}),t.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500 w-40",children:e.sp_account||"N/A"}),t.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500 w-32",children:e.sp_domain||"N/A"}),t.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-center w-28",children:t.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+(1==e.domain_verified?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:1==e.domain_verified?"Verified":"Invalid"})}),t.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-center w-28",children:t.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+(_(e)?"bg-yellow-100 text-yellow-800":1==e.domain_status?"bg-blue-100 text-blue-800":"bg-orange-100 text-red-800"),children:_(e)?"Timeout":1==e.domain_status?"Valid":"Invalid"})}),t.jsx("td",{className:"px-4 py-4 text-xs text-gray-700 w-64 max-w-md",title:e.validation_response||e.smtp_response||"N/A",children:t.jsx("div",{className:"break-words whitespace-normal",children:e.validation_response||e.smtp_response||"N/A"})})]},e.id))})]})}),t.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:t.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:["Showing"," ",t.jsx("span",{className:"font-medium",children:(j.page-1)*j.rowsPerPage+1})," ","to"," ",t.jsx("span",{className:"font-medium",children:Math.min(j.page*j.rowsPerPage,j.total)})," ","of ",t.jsx("span",{className:"font-medium",children:j.total.toLocaleString()})," emails"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>w(e=>({...e,page:1})),disabled:1===j.page||f,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:t.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})})}),t.jsx("button",{onClick:()=>w(e=>({...e,page:Math.max(1,e.page-1)})),disabled:1===j.page||f,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:t.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),t.jsxs("span",{className:"text-sm font-medium text-gray-700 px-2",children:["Page ",j.page," of"," ",Math.max(1,Math.ceil(j.total/j.rowsPerPage))]}),t.jsx("button",{onClick:()=>w(e=>({...e,page:Math.min(Math.ceil(j.total/j.rowsPerPage),e.page+1)})),disabled:j.page>=Math.ceil(j.total/j.rowsPerPage)||f,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:t.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})}),t.jsx("button",{onClick:()=>w(e=>({...e,page:Math.ceil(j.total/j.rowsPerPage)})),disabled:j.page>=Math.ceil(j.total/j.rowsPerPage)||f,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:t.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}),t.jsx("select",{value:j.rowsPerPage,onChange:e=>w(t=>({...t,rowsPerPage:Number(e.target.value),page:1})),className:"border p-2 rounded-lg text-sm bg-white focus:ring-blue-500 focus:border-blue-500 transition-colors ml-2",children:[10,25,50,100].map(e=>t.jsxs("option",{value:e,children:[e," / page"]},e))})]})]})})]})}):"login"===c?t.jsx(i,{onLogin:(e,t)=>{u(e),d(!0)},onSwitchToRegister:()=>m("register")}):t.jsx(o,{onRegister:()=>{m("login")},onSwitchToLogin:()=>m("login")})};l();const d=()=>{const[s,l]=e.useState({listName:"",fileName:"",csvFile:null}),[i,o]=e.useState(null),[d,c]=e.useState(!1),[m,x]=e.useState(!1),[u,p]=e.useState(!0),[g,h]=e.useState([]),[b,f]=e.useState({page:1,rowsPerPage:10,total:0,search:""}),[y,j]=e.useState(null);e.useRef(null);const w=e.useRef(),[v,N]=e.useState({}),[k,C]=e.useState(""),S=e.useCallback(async()=>{try{p(!0);const t=await r(`${a.GET_CSV_LIST}?limit=-1`);if(!t.ok)throw await t.text(),new Error(`HTTP error! status: ${t.status}`);const s=await t.text();let l;try{l=JSON.parse(s)}catch(e){throw new Error("Invalid JSON response from server")}if(!1===l.success)throw new Error(l.message||l.error||"Failed to load lists");const i=Array.isArray(l.data)?l.data.map(e=>({id:parseInt(e.id)||0,list_name:e.list_name||"Unknown",file_name:e.list_name||"Unknown",total_emails:parseInt(e.total_emails)||0,valid_count:parseInt(e.valid_count)||0,invalid_count:parseInt(e.invalid_count)||0,failed_count:parseInt(e.failed_count)||0,status:e.status||"pending",created_at:e.created_at,is_verification_list:!0})):[];h(i),f(e=>({...e,total:l.total||i.length}))}catch(t){h([]),f(e=>({...e,total:0})),(t.message.includes("401")||t.message.includes("Unauthorized"))&&(window.location.href="/login")}finally{p(!1)}},[]);e.useEffect(()=>{S()},[S]);const L=e=>{const{name:t,value:s}=e.target;l(e=>({...e,[t]:s}))},_=async(e,t)=>{try{const s=`${a.GET_RESULTS}?export=${e}&csv_list_id=${t}`,l=await r(s),i=await l.blob(),n=window.URL.createObjectURL(i),d=document.createElement("a");d.href=n,d.download=`${e}_emails_list_${t}.csv`,document.body.appendChild(d),d.click(),d.remove(),o({type:"success",message:`Exported ${e} emails list`})}catch{o({type:"error",message:`Failed to export ${e} emails`})}},P=({status:e,onClose:s})=>e&&t.jsxs("div",{className:`\n          fixed top-6 left-1/2 transform -translate-x-1/2 z-50\n          px-6 py-3 rounded-xl shadow-lg text-base font-bold\n          flex items-center gap-3\n          transition-all duration-300\n          backdrop-blur-md\n          ${"error"===e.type?"bg-red-50 border-2 border-red-500 text-red-700":"bg-green-50 border-2 border-green-500 text-green-700"}\n        `,style:{minWidth:250,maxWidth:600,boxShadow:"error"===e.type?"0 8px 32px 0 rgba(220, 38, 38, 0.4)":"0 8px 32px 0 rgba(34, 197, 94, 0.4)",background:"error"===e.type?"rgba(254, 226, 226, 0.95)":"rgba(220, 252, 231, 0.95)",borderRadius:"16px",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},role:"alert",children:[t.jsx("i",{className:"fas text-xl "+("error"===e.type?"fa-exclamation-circle text-red-600":"fa-check-circle text-green-600")}),t.jsx("span",{className:"flex-1",children:e.message}),t.jsx("button",{onClick:s,className:"ml-2 text-gray-500 hover:text-gray-700 focus:outline-none","aria-label":"Close",children:t.jsx("i",{className:"fas fa-times"})})]});e.useEffect(()=>{if(i){const e=setTimeout(()=>o(null),4e3);return()=>clearTimeout(e)}},[i]),e.useEffect(()=>{let e;return m&&(e=setInterval(()=>{S()},2e3)),()=>clearInterval(e)},[m,S]),e.useEffect(()=>{C(b.search)},[b.search]);const M=e=>{switch(e){case"completed":return"bg-emerald-100 text-emerald-800";case"running":return"bg-blue-100 text-blue-800";case"pending":return"bg-amber-100 text-amber-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return g.filter(e=>2===e.domain_status).length,t.jsxs("div",{className:"container mx-auto px-2 sm:px-4 py-4 sm:py-8 max-w-7xl",children:[t.jsx(P,{status:i,onClose:()=>o(null)}),t.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6 mb-6 sm:mb-8 mt-14 sm:mt-12",children:[t.jsxs("div",{className:"flex items-center mb-4 sm:mb-6",children:[t.jsx("div",{className:"bg-blue-100 p-2 rounded-lg mr-3 sm:mr-4",children:t.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})})}),t.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-800",children:"Upload Email List"})]}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),o(null),!s.csvFile||!s.listName||!s.fileName)return void o({type:"error",message:"All fields are required"});if((await s.csvFile.text()).split(/\r?\n/).filter(e=>""!==e.trim()).length<2)return void o({type:"error",message:"CSV file must contain at least one data row."});const t=new FormData;t.append("csv_file",s.csvFile),t.append("list_name",s.listName),t.append("file_name",s.fileName);try{c(!0);const e=await r(a.API_EMAIL_PROCESSOR,{method:"POST",body:t}),s=await e.json();if(s.success||"success"===s.status){const e=s.data?.valid_count||s.imported||0,t=s.data?.invalid_count||0;let a=s.message||`Successfully imported ${e} records!`;t>0&&(a+=` | Invalid: ${t}`),o({type:"success",message:a}),l({listName:"",fileName:"",csvFile:null}),s.data?.list_details&&h(e=>[s.data.list_details,...e]),S()}else o({type:"error",message:s.error||s.message||"Import failed"})}catch(i){o({type:"error",message:"Network error: "+i.message})}finally{c(!1)}},className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["List Name",t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("input",{type:"text",name:"listName",value:s.listName,onChange:L,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"e.g. My Email List",required:!0})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["File Name",t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("input",{type:"text",name:"fileName",value:s.fileName,onChange:L,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"e.g. emails_jan_2025.csv",required:!0})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["CSV File",t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-blue-400 transition-colors",children:t.jsx("div",{className:"space-y-1 text-center",children:s.csvFile?t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsx("div",{className:"bg-green-100 p-2 rounded-lg mr-4",children:t.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t.jsxs("div",{className:"text-left",children:[t.jsx("p",{className:"text-sm font-medium text-gray-700",children:s.csvFile.name}),t.jsxs("p",{className:"text-xs text-gray-500",children:[(s.csvFile.size/1024).toFixed(1)," KB"]})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),t.jsxs("div",{className:"flex text-sm text-gray-600 justify-center",children:[t.jsxs("label",{className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none",children:[t.jsx("span",{children:"Upload a file"}),t.jsx("input",{type:"file",name:"csvFile",className:"sr-only",accept:".csv",onChange:e=>{const t=e.target.files[0];t&&t.size>5242880?o({type:"error",message:"CSV file size must be 5 MB or less."}):l(e=>({...e,csvFile:t}))},required:!0})]}),t.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),t.jsx("p",{className:"text-xs text-gray-500",children:"Only 5MB CSV files"})]})})})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx("button",{type:"submit",disabled:d,className:"px-6 py-3 bg-blue-600 text-white font-medium rounded-lg shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors flex items-center disabled:opacity-70",children:d?t.jsxs(t.Fragment,{children:[t.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"w-5 h-5 mr-2 -ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})}),"Upload & Verify"]})})})]})]}),t.jsxs("div",{className:"bg-white rounded-lg sm:rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 gap-3 sm:gap-4",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"bg-blue-100 p-2 rounded-lg mr-3 sm:mr-4",children:t.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),t.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-800",children:"Email Lists"})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[t.jsxs("div",{className:"relative flex-grow max-w-md",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("input",{type:"text",placeholder:"Search lists...",className:"pl-10 w-full border border-gray-300 rounded-lg py-2 px-4 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:k,onChange:e=>{const t=e.target.value;C(t),clearTimeout(w.current),w.current=setTimeout(()=>{f(e=>({...e,search:t,page:1}))},400)}})]}),t.jsx("div",{className:"flex gap-2"})]})]}),t.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0 sm:rounded-lg border-t sm:border border-gray-200",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),t.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"List Name"}),t.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Emails"}),t.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valid/Invalid"}),t.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u?Array.from({length:b.rowsPerPage}).map((e,s)=>t.jsxs("tr",{className:"animate-pulse",children:[t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 rounded w-12"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"h-6 bg-gray-200 rounded-full w-20"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),t.jsxs("td",{className:"px-6 py-4 flex gap-2",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-16"}),t.jsx("div",{className:"h-8 bg-gray-200 rounded w-16"}),t.jsx("div",{className:"h-8 bg-gray-200 rounded w-16"}),t.jsx("div",{className:"h-8 bg-gray-200 rounded w-20"})]})]},s)):0===g.length?t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500 text-sm",children:b.search?"No lists match your search criteria":"No lists found. Upload a CSV file to get started."})}):g.filter(e=>e.list_name.toLowerCase().includes(b.search.toLowerCase())).map((e,s)=>t.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[t.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:(b.page-1)*b.rowsPerPage+s+1}),t.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 text-sm text-gray-900",children:t.jsx("div",{className:"max-w-xs truncate",children:e.list_name})}),t.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:t.jsx("span",{className:`px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${M(e.status)}`,children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),t.jsxs("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500",children:[e.total_emails," ",t.jsx("span",{className:"hidden sm:inline",children:"total"})]}),t.jsxs("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm",children:[t.jsxs("span",{className:"text-emerald-600 font-medium",children:[e.valid_count||0," valid"]})," ","/"," ",t.jsxs("span",{className:"text-red-600 font-medium",children:[e.invalid_count||0," invalid"]})]}),t.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 text-sm font-medium",children:t.jsxs("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:[t.jsxs("button",{onClick:()=>j(e.id),className:"text-blue-600 hover:text-blue-800 transition-colors flex items-center text-xs sm:text-sm px-2 py-1 rounded hover:bg-blue-50",children:[t.jsxs("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 sm:mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]}),t.jsxs("button",{onClick:()=>_("valid",e.id),className:"text-green-600 hover:text-green-800 transition-colors flex items-center",children:[t.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Valid"]}),t.jsxs("button",{onClick:()=>_("invalid",e.id),className:"text-red-600 hover:text-red-800 transition-colors flex items-center",children:[t.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Invalid"]}),t.jsxs("button",{onClick:()=>(async e=>{N(t=>({...t,[e]:!0})),o(null);try{const t=await r(`${a.GET_RESULTS}?retry_failed=1&csv_list_id=${e}`),s=await t.json();if(!s.total||0===s.total)return o({type:"error",message:"No failed emails to retry for this list"}),void N(t=>({...t,[e]:!1}));const l=await r(`${a.RETRY_SMTP}?csv_list_id=${e}`,{method:"POST"}),i=await l.json();if("success"!==i.status)throw new Error(i.message||"Failed to start retry");o({type:"success",message:`Retry started for ${s.total} emails in list ${e}`}),S()}catch(t){o({type:"error",message:t.message})}finally{N(t=>({...t,[e]:!1}))}})(e.id),disabled:v[e.id]||!e.failed_count,className:"text-yellow-600 hover:text-yellow-800 transition-colors flex items-center border border-yellow-300 rounded px-2 py-1 disabled:opacity-60",title:"Retry failed emails for this list",children:[t.jsx("svg",{className:"w-4 h-4 mr-1 "+(v[e.id]?"animate-spin":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h5M20 20v-5h-5M5.5 8.5a8 8 0 0113 0M18.5 15.5a8 8 0 01-13 0"})}),v[e.id]?"Retrying...":`Retry (${e.failed_count||0})`]})]})})]},e.id))})]})}),g.length>0&&t.jsxs("div",{className:"flex flex-col items-center justify-center mt-6 px-1 gap-2",children:[t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["Showing"," ",t.jsx("span",{className:"font-medium",children:(b.page-1)*b.rowsPerPage+1})," ","to"," ",t.jsx("span",{className:"font-medium",children:Math.min(b.page*b.rowsPerPage,b.total)})," ","of ",t.jsx("span",{className:"font-medium",children:b.total})," ","lists"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>f(e=>({...e,page:1})),disabled:1===b.page,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors font-bold text-gray-900",children:t.jsx("svg",{className:"w-5 h-5 text-gray-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})})}),t.jsx("button",{onClick:()=>f(e=>({...e,page:e.page-1})),disabled:1===b.page,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors font-bold text-gray-900",children:t.jsx("svg",{className:"w-5 h-5 text-gray-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),t.jsxs("span",{className:"text-sm font-bold text-gray-900",children:["Page ",b.page," of"," ",Math.max(1,Math.ceil(b.total/b.rowsPerPage))]}),t.jsx("button",{onClick:()=>f(e=>({...e,page:Math.min(Math.ceil(b.total/b.rowsPerPage),e.page+1)})),disabled:b.page>=Math.ceil(b.total/b.rowsPerPage),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors font-bold text-gray-900",children:t.jsx("svg",{className:"w-5 h-5 text-gray-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})}),t.jsx("button",{onClick:()=>f(e=>({...e,page:Math.ceil(b.total/b.rowsPerPage)})),disabled:b.page>=Math.ceil(b.total/b.rowsPerPage),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors font-bold text-gray-900",children:t.jsx("svg",{className:"w-5 h-5 text-gray-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}),t.jsx("select",{value:b.rowsPerPage,onChange:e=>f(t=>({...t,rowsPerPage:Number(e.target.value),page:1})),className:"border p-2 rounded-lg text-sm bg-white focus:ring-blue-500 focus:border-blue-500 transition-colors",children:[10,25,50,100].map(e=>t.jsx("option",{value:e,children:e},e))})]})]})]}),y&&t.jsx(n,{listId:y,onClose:()=>j(null)})]})};export{d as default};
